<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Responsibility Plan | SAMPROX ERP</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}" />
</head>
<body>
    <div class="page">
        <header class="topbar">
            <div class="brand">
                <div class="brand__logo">S</div>
                <div class="brand__details">
                    <p class="brand__name">SAMPROX ERP</p>
                    <p class="brand__section">Responsibility Portal</p>
                </div>
            </div>
            <div class="topbar__actions">
                <div class="user-summary">
                    <span class="user-summary__name" id="user-name"></span>
                    <span class="user-summary__role" id="user-role"></span>
                </div>
                <button type="button" class="button button--secondary" id="logout">Sign out</button>
            </div>
        </header>
        <main class="section">
            <section class="responsibility-plan" aria-labelledby="responsibility-plan-heading">
                <div class="responsibility-plan__header">
                    <div>
                        <h2 class="responsibility-plan__title" id="responsibility-plan-heading">Responsibility plan</h2>
                        <p class="responsibility-plan__description">
                            Assign and monitor managerial responsibilities, plan recurring tasks, and keep everyone informed.
                        </p>
                    </div>
                    <div class="responsibility-plan__header-actions">
                        <button type="button" class="button button--primary" id="responsibility-create-button">
                            New responsibility
                        </button>
                    </div>
                </div>
                <div class="responsibility-plan__utilities">
                    <form class="responsibility-weekly-form" id="responsibility-weekly-form" novalidate>
                        <div class="responsibility-weekly-form__fields">
                            <label class="responsibility-weekly-form__label" for="responsibility-weekly-start">
                                Week starting
                                <input class="responsibility-weekly-form__input" id="responsibility-weekly-start" name="startDate" type="date" />
                            </label>
                            <label class="responsibility-weekly-form__label" for="responsibility-weekly-email">
                                Recipient email
                                <input
                                    class="responsibility-weekly-form__input"
                                    id="responsibility-weekly-email"
                                    name="recipientEmail"
                                    type="email"
                                    placeholder="name@example.com"
                                    required
                                />
                            </label>
                        </div>
                        <button type="submit" class="button button--secondary" id="responsibility-weekly-send">
                            Email Monday–Sunday plan
                        </button>
                    </form>
                    <p class="responsibility-plan__message" id="responsibility-weekly-message" hidden></p>
                </div>
                <div class="table-container">
                    <table class="team-table responsibility-table">
                        <thead>
                            <tr>
                                <th scope="col" rowspan="2">Responsibility No</th>
                                <th scope="col" rowspan="2">Title</th>
                                <th scope="col" rowspan="2">Progress</th>
                                <th scope="col" rowspan="2">Detail</th>
                                <th scope="col" rowspan="2">Assigned by</th>
                                <th scope="col" rowspan="2">Assigned to</th>
                                <th scope="col" rowspan="2">Delegated to</th>
                                <th scope="col" rowspan="2">Scheduled for</th>
                                <th scope="col" rowspan="2">5D Action</th>
                                <th scope="colgroup" colspan="4" class="responsibility-table__metrics-header">
                                    <span>Performance Metrics</span>
                                    <button
                                        type="button"
                                        class="responsibility-table__metrics-help"
                                        id="responsibility-metrics-help"
                                        aria-label="Performance metrics help"
                                        title="Achievement = Actual ÷ Responsible × 100%. Example: Actual 8.5 kg with target 10 kg = 85.0%."
                                    >
                                        i
                                    </button>
                                </th>
                                <th scope="col" rowspan="2">Created</th>
                                <th scope="col" rowspan="2">Update</th>
                            </tr>
                            <tr>
                                <th scope="col">Unit of Measure</th>
                                <th scope="col">Responsible</th>
                                <th scope="col" data-sort-key="actual" tabindex="0">Actual</th>
                                <th scope="col" data-sort-key="metric" tabindex="0">Achievement %</th>
                            </tr>
                        </thead>
                        <tbody id="responsibility-table-body"></tbody>
                    </table>
                </div>
                <p class="responsibility-plan__empty" id="responsibility-empty" hidden>
                    No responsibilities have been added yet.
                </p>
                <p class="responsibility-plan__message" id="responsibility-message" hidden></p>
            </section>
        </main>
    </div>
    <div class="modal" id="responsibility-modal" hidden aria-hidden="true">
        <div class="modal__overlay" data-modal-dismiss></div>
        <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="responsibility-modal-title">
            <header class="modal__header">
                <h2 class="modal__title" id="responsibility-modal-title">New responsibility</h2>
                <button type="button" class="modal__close" id="responsibility-modal-close" aria-label="Close responsibility form">
                    <span aria-hidden="true">&times;</span>
                </button>
            </header>
            <div class="modal__body">
                <p class="modal__hint">Define the responsibility, choose the recurrence, and notify the appropriate manager.</p>
                <p class="alert alert--error" id="responsibility-form-error" hidden></p>
                <form class="edit-form" id="responsibility-form" novalidate>
                    <div class="edit-form__grid">
                        <div class="edit-form__field">
                            <label class="edit-form__label" for="responsibility-title">Title <span class="required">*</span></label>
                            <input class="edit-form__input" id="responsibility-title" name="title" type="text" required />
                        </div>
                        <div class="edit-form__field edit-form__field--full">
                            <label class="edit-form__label" for="responsibility-description">Description</label>
                            <textarea class="edit-form__input" id="responsibility-description" name="description" rows="3"></textarea>
                        </div>
                        <div class="edit-form__field edit-form__field--full">
                            <label class="edit-form__label" for="responsibility-detail">Detail</label>
                            <textarea class="edit-form__input" id="responsibility-detail" name="detail" rows="3"></textarea>
                        </div>
                        <div class="edit-form__field">
                            <label class="edit-form__label" for="responsibility-date">First scheduled date <span class="required">*</span></label>
                            <input class="edit-form__input" id="responsibility-date" name="scheduledFor" type="date" required />
                        </div>
                        <div class="edit-form__field">
                            <label class="edit-form__label" for="responsibility-recurrence">Recurrence <span class="required">*</span></label>
                            <select class="edit-form__input" id="responsibility-recurrence" name="recurrence" required>
                                <option value="does_not_repeat">Does not repeat</option>
                                <option value="monday_to_friday">Monday to Friday</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly on (Today)</option>
                                <option value="monthly">Monthly on (Today)</option>
                                <option value="annually">Annually on (Today)</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                        <fieldset class="edit-form__field edit-form__field--full" id="responsibility-custom-days" hidden>
                            <legend class="edit-form__label">Custom weekdays <span class="required">*</span></legend>
                            <div class="responsibility-custom-weekdays" id="responsibility-custom-weekdays">
                                <label class="responsibility-custom-weekdays__option">
                                    <input type="checkbox" value="0" name="customWeekdays" />
                                    <span>Monday</span>
                                </label>
                                <label class="responsibility-custom-weekdays__option">
                                    <input type="checkbox" value="1" name="customWeekdays" />
                                    <span>Tuesday</span>
                                </label>
                                <label class="responsibility-custom-weekdays__option">
                                    <input type="checkbox" value="2" name="customWeekdays" />
                                    <span>Wednesday</span>
                                </label>
                                <label class="responsibility-custom-weekdays__option">
                                    <input type="checkbox" value="3" name="customWeekdays" />
                                    <span>Thursday</span>
                                </label>
                                <label class="responsibility-custom-weekdays__option">
                                    <input type="checkbox" value="4" name="customWeekdays" />
                                    <span>Friday</span>
                                </label>
                                <label class="responsibility-custom-weekdays__option">
                                    <input type="checkbox" value="5" name="customWeekdays" />
                                    <span>Saturday</span>
                                </label>
                                <label class="responsibility-custom-weekdays__option">
                                    <input type="checkbox" value="6" name="customWeekdays" />
                                    <span>Sunday</span>
                                </label>
                            </div>
                        </fieldset>
                        <div class="edit-form__field">
                            <label class="edit-form__label" for="responsibility-assignee">Assign to</label>
                            <select class="edit-form__input" id="responsibility-assignee" name="assigneeId">
                                <option value="">Select a manager (optional)</option>
                            </select>
                        </div>
                        <div class="edit-form__field">
                            <label class="edit-form__label" for="responsibility-action">5D Action <span class="required">*</span></label>
                            <select class="edit-form__input" id="responsibility-action" name="action" required>
                                <option value="">Select</option>
                                <option value="done">Done</option>
                                <option value="delegated">Delegated</option>
                                <option value="deferred">Deferred</option>
                                <option value="discussed">Discussed</option>
                                <option value="deleted">Deleted</option>
                            </select>
                        </div>
                        <div class="edit-form__field" id="responsibility-delegated-field" hidden>
                            <label class="edit-form__label" for="responsibility-delegated-to">Delegated to <span class="required">*</span></label>
                            <select class="edit-form__input" id="responsibility-delegated-to" name="delegatedToId">
                                <option value="">Select a manager</option>
                            </select>
                        </div>
                        <fieldset class="edit-form__field edit-form__field--full responsibility-performance" id="responsibility-performance-section">
                            <legend class="edit-form__label responsibility-performance__legend">
                                Performance Metrics <span class="required">*</span>
                                <button
                                    type="button"
                                    class="responsibility-performance__help"
                                    id="responsibility-performance-help"
                                    aria-label="Performance metrics help"
                                    title="Achievement = Actual ÷ Responsible × 100%. Values adjust automatically based on the selected unit."
                                >
                                    i
                                </button>
                            </legend>
                            <p class="responsibility-performance__description" id="responsibility-performance-description">
                                Track how responsibilities perform against targets. Select a unit, enter the responsible target and the actual achieved value, and the achievement percentage will be calculated automatically.
                            </p>
                            <p class="responsibility-performance__alert" id="responsibility-performance-alert" hidden>
                                This responsibility uses default metrics. Please update the unit, responsible, and actual values.
                            </p>
                            <div class="responsibility-performance__grid">
                                <div class="responsibility-performance__control">
                                    <label class="edit-form__label" for="responsibility-perf-uom-input">Unit of Measure <span class="required">*</span></label>
                                    <div class="responsibility-performance__combobox">
                                        <input
                                            class="edit-form__input"
                                            id="responsibility-perf-uom-input"
                                            type="search"
                                            list="responsibility-perf-uom-options"
                                            placeholder="Search unit"
                                            autocomplete="off"
                                            aria-describedby="responsibility-perf-uom-hint"
                                        />
                                        <input type="hidden" id="responsibility-perf-uom" name="perfUom" required />
                                        <datalist id="responsibility-perf-uom-options">
                                            {% for option in perf_unit_options %}
                                                <option value="{{ option.label }}"></option>
                                            {% endfor %}
                                        </datalist>
                                    </div>
                                    <p class="responsibility-performance__hint" id="responsibility-perf-uom-hint"></p>
                                    <p class="responsibility-performance__error" id="responsibility-perf-uom-error" hidden></p>
                                </div>
                                <div class="responsibility-performance__control">
                                    <label class="edit-form__label" for="responsibility-perf-responsible">Responsible <span class="required">*</span></label>
                                    <div class="responsibility-performance__input-wrapper">
                                        <span class="responsibility-performance__prefix" id="responsibility-perf-responsible-prefix"></span>
                                        <input
                                            class="edit-form__input"
                                            id="responsibility-perf-responsible"
                                            name="perfResponsibleValue"
                                            type="text"
                                            inputmode="decimal"
                                            autocomplete="off"
                                            required
                                            aria-describedby="responsibility-perf-responsible-hint"
                                        />
                                        <span class="responsibility-performance__suffix" id="responsibility-perf-responsible-suffix"></span>
                                    </div>
                                    <p class="responsibility-performance__hint" id="responsibility-perf-responsible-hint"></p>
                                    <p class="responsibility-performance__error" id="responsibility-perf-responsible-error" hidden></p>
                                </div>
                                <div class="responsibility-performance__control">
                                    <label class="edit-form__label" for="responsibility-perf-actual">Actual <span class="required">*</span></label>
                                    <div class="responsibility-performance__input-wrapper">
                                        <span class="responsibility-performance__prefix" id="responsibility-perf-actual-prefix"></span>
                                        <input
                                            class="edit-form__input"
                                            id="responsibility-perf-actual"
                                            name="perfActualValue"
                                            type="text"
                                            inputmode="decimal"
                                            autocomplete="off"
                                            required
                                            aria-describedby="responsibility-perf-actual-hint"
                                        />
                                        <span class="responsibility-performance__suffix" id="responsibility-perf-actual-suffix"></span>
                                    </div>
                                    <p class="responsibility-performance__hint" id="responsibility-perf-actual-hint"></p>
                                    <p class="responsibility-performance__error" id="responsibility-perf-actual-error" hidden></p>
                                </div>
                                <div class="responsibility-performance__control">
                                    <label class="edit-form__label" for="responsibility-perf-metric">Achievement %</label>
                                    <div class="responsibility-performance__metric">
                                        <input
                                            class="edit-form__input responsibility-performance__metric-input"
                                            id="responsibility-perf-metric"
                                            type="text"
                                            value="0.0%"
                                            readonly
                                            aria-describedby="responsibility-performance-description"
                                        />
                                        <span class="responsibility-performance__metric-badge" id="responsibility-perf-metric-badge">0.0%</span>
                                    </div>
                                    <p class="responsibility-performance__hint">Achievement = Actual ÷ Responsible × 100%.</p>
                                </div>
                            </div>
                        </fieldset>
                        <div class="edit-form__field">
                            <label class="edit-form__label" for="responsibility-progress">Progress (%)</label>
                            <input
                                class="edit-form__input"
                                id="responsibility-progress"
                                name="progress"
                                type="number"
                                min="0"
                                max="100"
                                step="1"
                                inputmode="numeric"
                                value="0"
                            />
                        </div>
                        <div class="edit-form__field">
                            <label class="edit-form__label" for="responsibility-recipient">Notification email <span class="required">*</span></label>
                            <input class="edit-form__input" id="responsibility-recipient" name="recipientEmail" type="email" required />
                        </div>
                    </div>
                    <input type="hidden" id="responsibility-action-notes" name="actionNotes" />
                    <div class="modal__actions">
                        <button type="button" class="button button--ghost" id="responsibility-cancel">Cancel</button>
                        <button type="submit" class="button button--primary" id="responsibility-submit">Save responsibility</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal" id="responsibility-action-notes-modal" hidden aria-hidden="true">
        <div class="modal__overlay" data-modal-dismiss></div>
        <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="responsibility-action-notes-title">
            <header class="modal__header">
                <h2 class="modal__title" id="responsibility-action-notes-title">Discussion details</h2>
                <button type="button" class="modal__close" id="responsibility-action-notes-close" aria-label="Close notes editor">
                    <span aria-hidden="true">&times;</span>
                </button>
            </header>
            <div class="modal__body">
                <p class="modal__hint">Record discussion points or reasons for the selected 5D action.</p>
                <p class="alert alert--error" id="responsibility-action-notes-error" hidden></p>
                <div class="edit-form__field edit-form__field--full">
                    <label class="edit-form__label" for="responsibility-action-notes-text">Notes <span class="required">*</span></label>
                    <textarea class="edit-form__input" id="responsibility-action-notes-text" rows="4"></textarea>
                </div>
                <div class="modal__actions">
                    <button type="button" class="button button--ghost" id="responsibility-action-notes-cancel">Cancel</button>
                    <button type="button" class="button button--primary" id="responsibility-action-notes-save">Save notes</button>
                </div>
            </div>
        </div>
    </div>
        <script>
        window.responsibilityPageConfig = {
            perfUnitOptions: {{ (perf_unit_options or []) | tojson }},
            allowedRoles: ["outside_manager"],
            allowedRedirect: "/mind",
            loginRedirect: "/"
        };
    </script>
    <script src="{{ url_for('static', filename='js/responsibilities.js') }}" defer></script>

</body>
</html>
